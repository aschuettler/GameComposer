<!--
  ~ Copyright 2016 Mirko Sertic
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~       http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">

<dom-module id="gameeditor-tabbedpane">
    <template>
        <style include="global-shared-styles">
            .tabpane {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
            }

            .tabpanebuttons {
                flex-direction: row;
                display: flex;
                line-height: 1.45em;
                background-color: #e74c3c;
            }

            .tabpanebutton {
                color: white;
                margin-left: 1em;
                padding: 0.2em;
                background-color: #e74c3c;
            }

            .closebutton {
                width: 18px;
                height: 18px;
                display: inline-block;
                vertical-align: middle;
                content: url("close.png");
            }

            .tabpanebutton:hover {
                background-color: #4a5058;
            }

            .selected {
                background-color: #4a5058;
            }
        </style>

        <div class="tabpane">
            <div id="buttons" class="tabpanebuttons">
                <div class="tabpanebutton"><span>Pane 1</span><img class="closebutton"></div>
                <div class="tabpanebutton selected">Pane 2</div>
                <div class="tabpanebutton">Pane 3</div>
            </div>
            <div id="con"></div>
                <content id="content"></content>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'gameeditor-tabbedpane',

            properties: {
                selectedtab: {
                    type: Number,
                    notify: true,
                    value: -1

                },
                tabs: {
                    type: Object,
                    value: []
                }
            },

            clearAll: function() {
                var theButtonsDom = Polymer.dom(this.$.buttons);
                while (theButtonsDom.firstChild) {
                    theButtonsDom.removeChild(theButtonsDom.firstChild);
                }
                this.tabs = [];
            },

            clearContent: function() {
                var theDom = Polymer.dom(this);
                while (theDom.firstChild) {
                    theDom.removeChild(theDom.firstChild);
                }
            },

            createClickHandler: function(aIndex) {
                var theThis = this;
                return function(e) {
                    theThis.selectedtab = aIndex;
                    theThis.rebuildTabs();
                    theThis.setContent(theThis.tabs[aIndex].element);
                }
            },

            createDeleteClickHandler: function(aIndex) {
                var theThis = this;
                return function(e) {
                    theThis.fire("tabclose", {tabindex: aIndex});
                }
            },

            rebuildTabs: function() {

                var theButtonsDom = Polymer.dom(this.$.buttons);
                while (theButtonsDom.firstChild) {
                    theButtonsDom.removeChild(theButtonsDom.firstChild);
                }

                for (var i=0;i<this.tabs.length;i++) {
                    var theTab = this.tabs[i]

                    var theDiv = document.createElement("div");
                    var theDivContent = document.createElement("span");
                    theDivContent.innerText = theTab.title;
                    var theCloseButton = document.createElement("img");
                    theCloseButton.className = 'closebutton';
                    theDiv.appendChild(theDivContent);
                    theDiv.appendChild(theCloseButton);
                    if (i == this.selectedtab) {
                        theDiv.className = 'tabpanebutton selected';
                    } else {
                        theDiv.className = 'tabpanebutton';
                    }

                    theDiv.addEventListener("click", this.createClickHandler(i), true);
                    theCloseButton.addEventListener("click", this.createDeleteClickHandler(i), true);

                    Polymer.dom(this.$.buttons).appendChild(theDiv);
                }
//                Polymer.updateStyles();
            },

            addTab: function(aTitle, aElement) {
                this.tabs.push({
                    title: aTitle,
                    element: aElement
                });

                this.selectedtab = this.tabs.length - 1;

                this.rebuildTabs();
                this.setContent(aElement);

                return this.selectedtab;
            },

            setContent: function(aElement) {
                this.clearContent();
                Polymer.dom(this).appendChild(aElement);
            },

            selectTab(aIndex) {
                this.selectedtab = aIndex;
                this.rebuildTabs();
                this.setContent(this.tabs[aIndex].element);
            },

            removeTab(aIndex) {
                this.selectedtab--;
                this.tabs.splice(aIndex, 1);
                this.rebuildTabs();
            },

            ready: function() {
                this.fire("ready", {});
            }
        });
    </script>
</dom-module>